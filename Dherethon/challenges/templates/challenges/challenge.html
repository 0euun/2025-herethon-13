{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>나의 도전</title>
  <link rel="stylesheet" href="{% static 'index/my-challenge/myChallenge.css' %}">
</head>
<body>

<div class="container">
  <!-- 왼쪽 사이드바 -->
  <aside class="sidebar">
    <div class="profile">
      {% if user.profile_image and user.profile_image.url %}
        <img src="{{ user.profile_image.url }}" alt="프로필 이미지">
      {% else %}
        <img src="{% static 'images/default_profile.png' %}" alt="프로필 이미지">
      {% endif %}
      <p>{{ request.user.nickname }}</p>
    </div>
    <nav>
      <a href="{% url 'home:main' %}">홈</a>
      <a href="{% url 'challenges:my_challenges' %}" class="active">나의 도전</a>
      <a href="{% url 'community:post_list' %}">커뮤니티</a>
      <a href="{% url 'home:badge_list' %}">뱃지</a>
    </nav>
    <a href="{% url 'api:logout' %}" class="logout">Log out</a>
  </aside>

  <!-- 메인 콘텐츠 -->
  <main class="challenge-main">
    <!-- 상단: 제목/탭 -->
    <div class="challenge-header">
      <h2>{{ request.user.nickname }} 님의 Challenges</h2>
      <div class="challenge-tabs">
        {% for name in category_list %}
          <button class="tab {% if selected_category == name %}active{% endif %}">
            {{ name }}
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- 리스트 헤더 -->
    <div class="challenge-list-header">
      <div>도전리스트</div>
      <div>진행률</div>
      <div>다음 세부 목표</div>
    </div>

    <!-- 도전 리스트 -->
    <div class="challenge-list">
      {% for challenge in challenges %}
        {% if not challenge.badge_received %}
          <div class="challenge-item">
            <div class="challenge-info">
              <div class="category">{{ challenge.category.name }}</div>
              <div class="title">
                <a href="{% url 'challenges:detail' challenge.id %}">
                  {{ challenge.title }}
                </a>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress" style="width: {{ challenge.progress_percent }}%"></div>
              <span>{{ challenge.progress_percent }}%</span>
            </div>
            <div class="next-goal">
              {% if challenge.next_goal %}
                {{ challenge.next_goal.content }}
              {% else %}
                다음 세부 목표 없음
              {% endif %}
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <!-- 도전 추가 버튼 -->
    <button class="challenge-add-btn" onclick="location.href='{% url 'challenges:create' %}'">도전 추가하기</button>
  </main>

  <!-- 오른쪽 사이드 카드 -->
  <aside class="challenge-side-cards-wrapper">
    <h3>오늘의 도전</h3>
    <div class="challenge-side-cards">
      {% for challenge in incomplete_challenges %}
        <div class="side-card">
          {% if challenge.image %}
            <img src="{{ challenge.image.url }}" alt="도전 이미지">
          {% endif %}
          <p class="category">{{ challenge.category.name }}</p>
          <p class="title">{{ challenge.title }}</p>
          <a class="cert-btn" href="{% url 'challenges:detail' challenge.id %}">인증하러 가기 →</a>
        </div>
      {% endfor %}
    </div>
  </aside>
</div>

<script src="{% static 'index/my-challenge/myChallenge.js' %}"></script>
</body>
</html>
